<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OCS Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <header class="navbar">
        <div class="container">
            <h1 class="logo"><img src="/static/ocs-logo.png" alt="OCS Logo" class="logo-img"> Obion County Schools</h1>            <nav>
                {% if request.url.path != '/' %}
                <a href="/" class="nav-link"><i class="fa fa-home"></i> Home</a>
                {% endif %}
                {% if menu_visibility.tickets %}
                <div class="dropdown">
                    <a href="#" class="nav-link"><i class="fa-solid fa-ticket"></i> Tickets <i class="fa fa-caret-down"></i></a>                    <div class="dropdown-content">                        <div class="dropdown-section">Tech Tickets
                            <a href="/tickets/tech/new">New Ticket</a>
                            <a href="/tickets/tech/open">Tickets</a>
                        </div>
                        <div class="dropdown-section">Maintenance Tickets
                            <a href="/tickets/maintenance/new">New Ticket</a>
                            <a href="/tickets/maintenance/open">Tickets</a>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% if menu_visibility.inventory %}
                <div class="dropdown">
                    <a href="#" class="nav-link"><i class="fa-solid fa-boxes-stacked"></i> Inventory <i class="fa fa-caret-down"></i></a>
                    <div class="dropdown-content">
                        <a href="/inventory/add">Add Inventory</a>
                        <a href="/inventory/remove">Remove Inventory</a>
                        <a href="/inventory/edit">Edit Inventory</a>
                        <a href="/inventory/view">View Inventory</a>
                    </div>
                </div>
                {% endif %}                {% if menu_visibility.manage %}
                <div class="dropdown">
                    <a href="#" class="nav-link"><i class="fa-solid fa-gears"></i> Manage <i class="fa fa-caret-down"></i></a>
                    <div class="dropdown-content">
                        <a href="/manage/device-register">Device Register</a>
                    </div>
                </div>
                {% endif %}
                {% if menu_visibility.purchasing %}
                <div class="dropdown">
                    <a href="#" class="nav-link"><i class="fa-solid fa-shopping-cart"></i> Purchasing <i class="fa fa-caret-down"></i></a>
                    <div class="dropdown-content">
                        <a href="/purchasing/requisitions">Requisitions</a>
                        <a href="/purchasing/purchase-orders">Purchase Orders</a>
                    </div>
                </div>
                {% endif %}
                {% if menu_visibility.forms %}
                <div class="dropdown">
                    <a href="#" class="nav-link"><i class="fa-solid fa-clipboard-list"></i> Forms <i class="fa fa-caret-down"></i></a>
                    <div class="dropdown-content">
                        <a href="/forms/time">Time Forms</a>
                        <a href="/forms/fuel">Fuel Tracking</a>
                    </div>
                </div>
                {% endif %}
                {% if menu_visibility.admin %}
                <div class="dropdown">
                    <a href="#" class="nav-link"><i class="fa-solid fa-user-gear"></i> Admin <i class="fa fa-caret-down"></i></a>
                    <div class="dropdown-content">                        <a href="/users/list">Users</a>
                        <a href="/buildings/list">Buildings</a>
                        <!-- You can add more admin options here -->
                    </div>
                </div>
                {% endif %}                
                <!-- Notifications -->
                {% if user %}
                <div class="notification-center">
                    <button class="notification-bell" onclick="toggleNotificationCenter()">
                        <i class="fa fa-bell"></i>
                        <span id="notification-badge" class="notification-badge" style="display: none;"></span>
                        <span id="notification-status" class="notification-status disconnected"></span>
                    </button>
                    <div id="notification-dropdown" class="notification-dropdown" style="display: none;">
                        <div class="notification-header">
                            <h4>Notifications</h4>
                            <button onclick="notificationClient.clearAllNotifications()" class="clear-all-btn">Clear All</button>
                        </div>
                        <div id="notifications-list" class="notifications-list">
                            <!-- Notifications will be inserted here -->
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Logout Button -->
                <a href="/auth/logout" class="nav-link logout-btn" onclick="return confirm('Are you sure you want to log out?')">
                    <i class="fa-solid fa-sign-out-alt"></i> Logout
                </a>
            </nav>
        </div>
    </header>
    <main class="container">
        {% block content %}{% endblock %}    </main>
    
    <!-- Toast Container for notifications -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- User data for JavaScript -->    {% if user %}
    <div style="display: none;" 
         data-user-id="{{ user.user_id or user.email }}" 
         data-user-permissions="{{ user.permissions | tojson }}">
    </div>
    {% endif %}
    
    <!-- Load notification client -->
    <script src="/static/js/notifications.js"></script>
    
    <script>
    // Toggle notification center dropdown
    function toggleNotificationCenter() {
        const dropdown = document.getElementById('notification-dropdown');
        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
    }
    
    // Close notification center when clicking outside
    document.addEventListener('click', function(event) {
        const notificationCenter = document.querySelector('.notification-center');
        const dropdown = document.getElementById('notification-dropdown');
        
        if (dropdown && !notificationCenter.contains(event.target)) {
            dropdown.style.display = 'none';
        }
    });
    
    // Toggle .open class on dropdowns for click-to-open submenu
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.dropdown > .nav-link').forEach(function(link) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                // Close other open dropdowns
                document.querySelectorAll('.dropdown.open').forEach(function(dd) {
                    if (dd !== link.parentElement) dd.classList.remove('open');
                });
                // Toggle this dropdown
                link.parentElement.classList.toggle('open');
            });
        });
        // Optional: close dropdown if clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown.open').forEach(function(dd) {
                    dd.classList.remove('open');
                });
            }
        });
    });
    </script>
</body>
</html>
